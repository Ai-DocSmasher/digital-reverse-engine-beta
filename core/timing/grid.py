# core/timing/grid.pyfrom dataclasses import dataclass@dataclassclass TimingGrid:    sample_rate: int    tempo: float = 120.0          # BPM    beats_per_bar: int = 4        # usually 4    @property    def beat_duration_seconds(self) -> float:        return 60.0 / self.tempo    @property    def bar_duration_seconds(self) -> float:        return self.beat_duration_seconds * self.beats_per_bar    @property    def beat_samples(self) -> int:        return int(self.beat_duration_seconds * self.sample_rate)    @property    def bar_samples(self) -> int:        return int(self.bar_duration_seconds * self.sample_rate)    def subdivision_samples(self, fraction: float) -> int:        """        fraction = 0.25 -> quarter-beat        fraction = 0.5  -> half-beat        fraction = 1.0  -> one beat        """        return max(int(self.beat_samples * fraction), 128)    def build_grid(self, total_samples: int, unit: str = "beat", fraction: float = 1.0):        """        unit: "beat", "bar", "subdivision"        fraction: used only for "subdivision"        Returns an array of sample indices [0, ..., total_samples]        """        if unit == "beat":            step = self.beat_samples        elif unit == "bar":            step = self.bar_samples        elif unit == "subdivision":            step = self.subdivision_samples(fraction)        else:            raise ValueError(f"Unknown unit for TimingGrid: {unit}")        if step <= 0:            step = 128        import numpy as np        grid = np.arange(0, total_samples, step, dtype=int)        if len(grid) == 0 or grid[-1] != total_samples:            grid = np.append(grid, total_samples)        return grid