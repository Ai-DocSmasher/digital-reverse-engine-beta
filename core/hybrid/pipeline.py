import timeimport numpy as npfrom core.dsp.reverse_modes import (    true_reverse,    grain_reverse,    transientaware_reverse,    hq_reverse,    dj_reverse,    studio_reverse,)MODE_MAP = {    "TRUE_REVERSE": true_reverse,    "GRAIN_REVERSE": grain_reverse,    "TRANSIENTAWARE_REVERSE": transientaware_reverse,    "HQ_REVERSE": hq_reverse,    "DJ_REVERSE": dj_reverse,    "STUDIO_REVERSE": studio_reverse,}from core.economic.cost_estimator import CostEstimatorfrom core.economic.receipt_generator import generate_receiptMODE_MAP = {    "TRUE_REVERSE": true_reverse,    "GRAIN_REVERSE": grain_reverse,    "TRANSIENTAWARE_REVERSE": transientaware_reverse,    "HQ_REVERSE": hq_reverse,}def process_audio(    audio: np.ndarray,    sample_rate: int,    mode: str,    tier: str,    enriched_metadata: dict,):    if mode not in MODE_MAP:        raise ValueError(f"Unknown mode: {mode}")    dsp_fn = MODE_MAP[mode]    # DSP timing    t0 = time.time()    processed = dsp_fn(audio, sample_rate)    dsp_time = time.time() - t0    # Economic engine    estimator = CostEstimator()    cost = estimator.estimate_cost(enriched_metadata)    gating = estimator.apply_gating(cost, tier)    # Receipt    receipt = generate_receipt(        input_audio=audio,        output_audio=processed,        metadata=enriched_metadata,        mode=mode,        tier=tier,        datacostunits=cost,        gating=gating,    )    meta = {        "mode": mode,        "tier": tier,        "sample_rate": sample_rate,        "input_shape": audio.shape,        "output_shape": processed.shape,        "dsp_time_s": dsp_time,        "datacostunits": cost,        "gating": gating,    }    return processed, meta, receiptif __name__ == "__main__":    # Dummy test mode    sr = 44100    audio = np.random.randn(sr).astype(np.float32)    enriched_metadata = {        "contribution_type": "internal_test",        "complexity_factor": 1.0,        "transient_density": 0.2,        "quality_proxy_score": 1.0,    }    out, meta, receipt = process_audio(        audio,        sample_rate=sr,        mode="HQ_REVERSE",        tier="free",        enriched_metadata=enriched_metadata,    )    print(meta)    print(receipt["signature"][:12])